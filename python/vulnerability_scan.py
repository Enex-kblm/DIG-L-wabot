import sys
import json
import requests
from bs4 import BeautifulSoup

def vulnerability_scan(url):
    try:
        # Contoh: Deteksi form tanpa CSRF token
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')
        forms = soup.find_all('form')
        
        vulnerable_forms = []
        for form in forms:
            if not form.find('input', {'name': 'csrf_token'}):
                vulnerable_forms.append(str(form))
        
        return {
            "url": url,
            "vulnerabilities": {
                "csrf_missing": vulnerable_forms,
            },
            "error": None
        }
    except Exception as e:
        return {"error": str(e)}

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(json.dumps({"error": "URL tidak diberikan"}))
        sys.exit(1)
    
    url = sys.argv[1]
    print(json.dumps(vulnerability_scan(url)))